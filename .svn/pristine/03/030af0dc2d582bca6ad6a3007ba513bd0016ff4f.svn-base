package kr.or.ddit.groupware.board.notice.service;

import java.io.IOException;
import java.util.List;

import javax.inject.Inject;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.core.io.Resource;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Service;

import kr.or.ddit.common.exception.BoardNotFoundException;
import kr.or.ddit.groupware.board.notice.dao.NoticeBoardDAO;
import kr.or.ddit.groupware.board.notice.dao.NoticeBoardFileDAO;
import kr.or.ddit.vo.PaginationInfo;
import kr.or.ddit.vo.groupware.BoardFileVO;
import kr.or.ddit.vo.groupware.BoardVO;
import lombok.RequiredArgsConstructor;

/**
 * @author 전수진
 * @since 2023. 11. 7.
 * @version 1.0
 * @see javax.servlet.http.HttpServlet 
 * <pre>
 * [[개정이력(Modification Information)]]
 * 수정일            수정자               수정내용
 * --------     --------    ----------------------
 * 2023. 11. 7.    전수진       최초작성
 * Copyright (c) 2023 by DDIT All right reserved
 * </pre>
 */
@Service
@RequiredArgsConstructor
public class NoticeBoardServiceImpl implements NoticeBoardService {
	
	private final NoticeBoardDAO noticeDAO;
	private final NoticeBoardFileDAO fileDAO;
	
	@Value("#{appInfo.boFiles}")
	private Resource boFiles;
	
	private void processBoFiles(BoardVO board) {
		List<BoardFileVO> fileList = board.getBoardFileList();
		if(fileList!=null) {
			fileList.forEach((f)->{
				try {
					f.setBbsNo(board.getBbsNo());
					fileDAO.insertFile(f);
					f.saveTo(boFiles.getFile());
				} catch(IOException e) {
					throw new RuntimeException(e);
				}
			});
		}
	}
	
	@Override
	public void createNoticeBoard(BoardVO board) {
		// 공지사항 게시글등록
		noticeDAO.insertNoticeBoard(board);
		processBoFiles(board);
	}

	@Override
	public BoardVO retrieveNoticeBoard(int bbsNo) {
		// 공지사항 게시글 1개 조회
		BoardVO board = noticeDAO.selectNoticeBoard(bbsNo);
		
		if(board==null) // 조회한 글이 없을경우
			throw new BoardNotFoundException(HttpStatus.NOT_FOUND, String.format("%d 해당 게시글이 없음", bbsNo));
		
		noticeDAO.incrementHit(bbsNo);
		return board;
	}

	@Override
	public BoardFileVO retrieveBoardFile(String fileCode) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public List<BoardVO> retrieveNoticeBoardList(PaginationInfo<BoardVO> paging) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public void modifyNoticeBoard(BoardVO board) {
		// TODO Auto-generated method stub
	}

	@Override
	public void removeNoticeBoard(int bbsNo) {
		// TODO Auto-generated method stub
	}

}
